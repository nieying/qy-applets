<view class="page-subject">
  <view class="header" style='padding-top: {{height}}px'>
    <icon type="clear" size="30" color="black" bindtap="goBack" />
    <view class='progress' wx:if="{{!isLoading}}">
      <progress percent="{{userInfo.unitProgress}}" backgroundColor="#B0BEC5" color="#FFD500" stroke-width="8" border-radius="8" />
    </view>
    <view class="money" wx:if="{{!isLoading}}">
      <image src='/pages/images/buy/icon-life.svg'></image> {{userInfo.cost}}</view>
  </view>
  <!-- loding页面 -->
  <view class='content' style="height: {{warpHeight - 130}}px" wx:if="{{isLoading}}">
    <view class='page-loading'>
      <image class='logo' src="/pages/images/logo.png"></image>
      <image class='man' src="/pages/images/man_woman.svg"></image>
    </view>
    <view class='bottom bottom-loading'>
      <view class='loading'>加载中…</view>
      <view class='tips'> {{currentDialect.remark}}</view>
    </view>
  </view>
  <block wx:else>
    <scroll-view scroll-y="true" style="height: {{warpHeight}}px" class="content">
      <view class='padding-box'>
        <view class='subject-type' wx:if="{{!isLoading}}">
          <!-- 文本 -->
          <view class='subject-txt' wx:if="{{subjectObj.type === 'normal'}}">
            <view class='name'>
              <text>选择正确的翻译</text>
            </view>
            <block wx:if="{{isAnswered}}">
              <view class='topic'>
                <view wx:for="{{subjectObj.titleList}}" wx:for-item="item" wx:key="index">
                  <text class="{{item.value ? 'underline' :''}}" data-item="{{item}}" bindtap="showNote">{{item.key}}</text>
                </view>
              </view>
              <view class="popover" wx:if="{{isShowNote}}">
                <view class='key'>{{currentNote.key}}:</view>
                <view class='value'>{{currentNote.value}}</view>
              </view>
            </block>
            <view wx:else class='topic'>{{subjectObj.title}}</view>
          </view>
          <!-- 看图题 -->
          <view class='subject-pic' wx:if="{{subjectObj.type === 'map'}}">
            <view class='name'>
              <text>{{subjectObj.title}}</text>
            </view>
            <image src="{{subjectObj.filePath}}"></image>
          </view>

          <!-- 听力题 -->
          <view class='subject-listen' wx:if="{{subjectObj.type === 'auto'}}">
            <view class='name'>
              <text>根据听到的内容选择</text>
              <image wx:if="{{!isPlay}}" src='/pages/images/subject/icon-listen.svg' bindtap="audioPlay"></image>
              <image wx:else src='/pages/images/subject/listen.gif' bindtap="audioStop"></image>
            </view>
            <view class='tips' wx:if="{{isPlay}}">播放音频播放中...</view>
            <view class='topic'></view>
          </view>

          <!-- 选图题 && 答题选项 -->
          <view class='subject-tone' wx:if="{{subjectObj.type === 'picture'}}">
            <view class='topic'>{{subjectObj.title}}</view>
            <view class='tone-list'>
              <block wx:for="{{subjectObj.answers}}" wx:for-item="item" wx:key="index">
                <view data-id="{{index}}" class="item {{ item.checked ? 'checked' :''}} {{(isAnswered && item.right === 1) && 'correct'}} {{(isAnswered && item.right === 0 && item.checked) && 'wrong' }}" bindtap='getradio'>
                  <icon wx:if="{{(!isAnswered && !item.checked) || (isAnswered && !item.checked && item.right !== 1)}}" type="success" size="30" color="white" />
                  <icon wx:if="{{!isAnswered && item.checked}}" type="success" size="30" color="#282D4B" />
                  <icon wx:if="{{isAnswered && item.right === 1}}" type="success" size="30" color="#00C853" />
                  <icon wx:if="{{isAnswered && item.right === 0 && item.checked}}" type="clear" size="30" color="#F44336" />
                  <image src='{{item.filePath}}'></image>
                </view>
              </block>
            </view>
          </view>
          <!-- 答题选项 -->
          <view class='answer-list' wx:if="{{subjectObj.type !== 'picture'}}">
            <block wx:for="{{subjectObj.answers}}" wx:for-item="item" wx:key="index">
              <view data-id="{{index}}" class="item {{ item.checked ? 'checked' :''}} {{(isAnswered && item.right === 1) && 'correct'}} {{(isAnswered && item.right === 0 && item.checked) && 'wrong' }}" bindtap='getradio'>
                <icon wx:if="{{(!isAnswered && !item.checked) || (isAnswered && !item.checked && item.right !== 1)}}" type="success" size="30" color="white" />
                <icon wx:if="{{!isAnswered && item.checked}}" type="success" size="30" color="#282D4B" />
                <icon wx:if="{{isAnswered && item.right === 1}}" type="success" size="30" color="#00C853" />
                <icon wx:if="{{isAnswered && item.right === 0 && item.checked}}" type="clear" size="30" color="#F44336" />
                <text>{{item.answer}}</text>
              </view>
            </block>
          </view>

          <view wx:if="{{isAnswered}}" class='answer-tips {{answerObj.className}}'>
            <icon type="{{answerObj.icon}}" size="30" color="{{answerObj.color}}" />
            <text>{{answerObj.txt1}}</text> {{answerObj.txt2}}
          </view>
        </view>
      </view>
    </scroll-view>
    <view wx:if="{{!isAnswered}}" class="bottom {{selectId && !isAnswered &&  'select'}}" bindtap='submit'>
      提交
    </view>
    <view wx:else class="bottom {{selectId === rightId && isAnswered &&  'bgcorrect'}} {{selectId !== rightId && isAnswered &&  'bgwrong'}}" bindtap='getNextSubject'>
      继续
    </view>
  </block>
</view>